<!doctype html>
<html>
    <style type="text/css">
        #propain{
            width: 800px;
            height: 600px;
            margin: 0px auto;
        }
        </style>
    <head>
        <meta charset="UTF-8" />
        
        <title>ProPain Game</title>
        <script type="text/javascript" src = "src/Player.js"></script>
        <script type="text/javascript"  src="lib/phaser.min.js"></script>
        <script type="text/javascript"  src="src/Engine.js"></script>
        <script type="text/javascript"  src ="src/PowerUp.js"></script>
       <script  src="/socket.io/socket.io.js"></script>
    </head>
    <body bgcolor="#7ec0ee">
        <center><img src="./assets/gfx/ProPainLogo.png" alt="ProPain"></center>
        
        <div id="propain">

            <script type="text/javascript">
                var socket;
                try{
                    //socket = io.connect("http://74.61.206.165", {port: 80, transports: ["websocket"]});
                    socket = io.connect("http://raineystreet", {port: 80, transports: ["websocket"]});
                }catch(err){
                    console.log("Server could not be reached");
                    console.log(err);
                }

                var remoteLeft = false;
                var remoteRight = false;
                var remoteJump = false;
                var remoteAttack = false;
                var remoteThrow = false;
                var localLeft = false;
                var localRight = false;
                var localJump = false;
                var localAttack = false;
                var localThrow = false;
                var localPlayer;
                var remotePlayer;
                window.onload = function() {
                        setEventHandlers();
                };
                var setEventHandlers = function() {
                    try{
                        socket.on("connect", this.onSocketConnected);
                        socket.on("new player", this.onNewPlayer);
                        socket.on("moveLeft", this.onMoveLeft);
                        socket.on("moveRight", this.onMoveRight);
                        socket.on("moveStop", this.onMoveStop);
                        socket.on("jump", this.onJump);
                        socket.on("jumpStop", this.onJumpStop);
                        socket.on("attack", this.onAttack);
                        socket.on("throw", this.onProjectile);
                        socket.on("dead", this.onRemoteDead);
                        socket.on("disconnect", this.onSocketDisconnect);
                    }catch(err){
                        console.log("Offline mode");
                    }
                    };
                function onSocketConnected() {
                    console.log("Connected to socket server");

                    game = new Phaser.Game(800, 600, Phaser.AUTO, 'propain', { preload: preload, create: create });
                    localPlayer = new Player(1, 'HANK',socket.io.engine.id , game.width/2 ,game.height-100);
                    function preload () {
                    }
                    function create () {
                        game.state.add('game', GameState, true);
                    }

                };

                function onSocketDisconnect() {
                       console.log("Disconnected from socket server");
                   };

                function onNewPlayer(data){
                       console.log("New player connected: "+data.id);
                       var newPlayer = new Player(2, 'DALE', data.id, data.x, data.y);
                       try{
                           newPlayer.enablePlayer(game);
                           remotePlayer = newPlayer;
                       }catch(err){
                           console.log("New Player failed to be created");
                           console.log(err);
                       }
                   };

                function onMoveLeft(data) {
                   console.log('left');
                   if(data.id == localPlayer.id){
                       localLeft = true;
                   }else{ 
                       remoteLeft = true;
                   }
                  };
                function onMoveRight(data) {
                   console.log('right');
                   console.log(data.id);
                   if(data.id == localPlayer.id){
                       localRight = true;
                   }else{
                       remoteRight = true;
                   }
                };
                function onMoveStop(data) {
                   console.log('stop');
                   if(data.id == localPlayer.id){
                       localLeft = false;
                       localRight = false;
                   }else{
                       remoteRight = false;
                       remoteLeft = false;
                   }
                };
                function onJump(data) {
                   console.log('jump');
                   if(data.id == localPlayer.id){
                       localJump = true;
                   }else{
                       remoteJump = true;
                   }
                };
                function onAttack(data) {
                   console.log('Attack');
                   if(data.id == localPlayer.id){
                       localAttack = true;
                   }else{
                       remoteAttack = true;
                   }
                };
                function onProjectile(data) {
                   console.log('throw');
                   if(data.id == localPlayer.id){
                       localThrow = true;
                   }else{
                       remoteThrow = true;
                   }
                };
                function onJumpStop(data) {
                   console.log('stop jump');
                   if(data.id == localPlayer.id){
                       localJump = false;
                   }else{
                       remoteJump = false;
                   }
                };
                function onRemoteDead(data) {
                   window.location.href = 'GamePage.html';
                };

            </script>
        </div>
        
        

    </body>
</html>
